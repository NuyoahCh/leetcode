# 官方链接
https://leetcode.cn/problems/implement-router/description/?envType=daily-question&envId=2025-09-20

## 题解
https://leetcode.cn/problems/implement-router/solutions/3787089/gomei-ri-yi-ti-by-code-review-7pxs/

## Code
```go
type Packet struct {
	Source, Destination, Timestamp int
}

type Pair struct {
	Timestamps []int
	Head       int
}

type Router struct {
	memoryLimit      int
	packetQ          []Packet
	packetSet        map[Packet]struct{}
	destToTimestamps map[int]*Pair
}

func Constructor(memoryLimit int) Router {
	return Router{
		memoryLimit:      memoryLimit,
		packetQ:          []Packet{},
		packetSet:        map[Packet]struct{}{},
		destToTimestamps: map[int]*Pair{},
	}
}

func (this *Router) AddPacket(source int, destination int, timestamp int) bool {
	p := Packet{source, destination, timestamp}
	if _, ok := this.packetSet[p]; ok {
		return false
	}
	if len(this.packetQ) == this.memoryLimit {
		this.ForwardPacket()
	}
	this.packetQ = append(this.packetQ, p)
	this.packetSet[p] = struct{}{}
	if _, ok := this.destToTimestamps[destination]; !ok {
		this.destToTimestamps[destination] = &Pair{}
	}
	this.destToTimestamps[destination].Timestamps = append(this.destToTimestamps[destination].Timestamps, timestamp)
	return true
}

func (this *Router) ForwardPacket() []int {
	if len(this.packetQ) == 0 {
		return []int{}
	}
	packet := this.packetQ[0]
	this.packetQ = this.packetQ[1:]
	delete(this.packetSet, packet)
	this.destToTimestamps[packet.Destination].Head++
	return []int{packet.Source, packet.Destination, packet.Timestamp}
}

func (this *Router) GetCount(destination int, startTime int, endTime int) int {
	p, ok := this.destToTimestamps[destination]
	if !ok {
		return 0
	}
	left := lowerBound(p.Timestamps, startTime, p.Head)
	right := lowerBound(p.Timestamps, endTime+1, p.Head)
	return right - left
}

func lowerBound(nums []int, target, left int) int {
	right := len(nums)
	for left < right {
		mid := (left + right) >> 1
		if nums[mid] >= target {
			right = mid
		} else {
			left = mid + 1
		}
	}
	return right
}
```